<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Espen Sirnes">
<meta name="dcterms.date" content="2025-08-14">

<title>1: Introduksjon</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Forelesning 1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Forelesning 1_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Forelesning 1_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Forelesning 1_files/libs/quarto-html/popper.min.js"></script>
<script src="Forelesning 1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Forelesning 1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Forelesning 1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Forelesning 1_files/libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Forelesning 1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Forelesning 1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Forelesning 1_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Forelesning-1.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="Forelesning 1.ipynb" download="Forelesning 1.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">1: Introduksjon</h1>
<p class="subtitle lead">SOK-2301 - Nytte-kostnadsanalyse i teori og praksis</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Espen Sirnes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 14, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="litt-om-kurset" class="level1">
<h1>Litt om kurset</h1>
<p>Alle innleveringer vil handle om ett case som dere skal jobbe med gjennom hele semesteret</p>
<ul>
<li>To obligatoriske innleveringer (arbeidskrav)</li>
<li>Presentasjoner (arbeidskrav)</li>
<li>Prosjektoppgave (karaktergivende)</li>
<li>Fra 1-3 i hver gruppe</li>
<li>Prosjektet dere skal jobbe med er å lage en samfunnsøkonomisk utredning av ny Kvaløyaforbindelse</li>
</ul>
</section>
<section id="problemstillingen" class="level1">
<h1>Problemstillingen</h1>
<p>Dagens bro til Kvaløya er overbelastet, noe som fører til kø, forsinkelser og redusert fremkommelighet for både privatpersoner og næringsliv. Dette skaper utfordringer for transport, beredskap og utvikling på Kvaløya, og det er behov for tiltak som kan bedre trafikksituasjonen og sikre tilstrekkelig kapasitet for fremtidig vekst. <img src=".\img/que_kvaloya.jpg" class="img-fluid" alt="Kø Kvaløya"></p>
<p>En ny forbindelse vil, i tillegg til å økt fremkommelighet og bedre bedre beredskap, potensielt kunne bidra til rimelige tomter. Tromsø er en av de dyreste byene å bo i. En ny Kvaløyaforbindelse kan knytte nye områder og rimelige tomter på Kvaløya nær sentrum, og bidra til lavere boligpriser.</p>
</section>
<section id="informasjon-som-må-innhentes" class="level1">
<h1>Informasjon som må innhentes</h1>
<ul>
<li>Hvor mye koster det å bygge tunnel?</li>
<li>Hva slags tunnel skal bygges</li>
<li>Hvilke traseer kan være aktuelle?</li>
<li>Samfunnsøkonomisk betydning av byutvikling (rimeligere tomter)</li>
<li>Hva vil det ha å si for
<ul>
<li>trafikksikkerhet</li>
<li>kollektivtransport</li>
<li>syklende og gående</li>
<li>natur og miljø</li>
<li>næringsutvikling/næringstrafikk</li>
</ul></li>
</ul>
</section>
<section id="innleveringene" class="level1">
<h1>Innleveringene</h1>
<section id="obligatorisk-innlevering-1-fase-1-3-ihht-veilederen" class="level2">
<h2 class="anchored" data-anchor-id="obligatorisk-innlevering-1-fase-1-3-ihht-veilederen">Obligatorisk innlevering 1 (Fase 1-3 ihht veilederen):</h2>
<ul>
<li>Gjør en vurdering av tiltaket ihht. DFØs veileder og identifiser hvilken informasjon som trengs og hvilke forutsetninger som må gjøres</li>
<li>Innhent informasjon</li>
<li>Sett opp en disposisjon/arbeidsplan (bruk veilederen)</li>
</ul>
</section>
<section id="obligatorisk-innlevering-2-fase-3-5" class="level2">
<h2 class="anchored" data-anchor-id="obligatorisk-innlevering-2-fase-3-5">Obligatorisk innlevering 2 (Fase 3-5):</h2>
<ul>
<li>Bruke det du har lært til å sette opp en nytte-kostnadsanalyse</li>
<li>Beregne nåverdi av prosjektet</li>
</ul>
</section>
<section id="endelig-innlevering-fase-1-8" class="level2">
<h2 class="anchored" data-anchor-id="endelig-innlevering-fase-1-8">Endelig innlevering (Fase 1-8):</h2>
<ul>
<li>Forbedre det som er gjort i tidligere innleveringer</li>
<li>Lever en endelig utredning av tiltaket.</li>
<li>Utredningen bør ha samme form som eksemplene i pensum.</li>
<li>Målet er en rapport som kunne vært presentert for Stortinget og Olje- og energidepartementet som grunnlag for en beslutning om elektrifisering.</li>
</ul>
</section>
</section>
<section id="nytte-kostnadsanalyse" class="level1">
<h1>Nytte-kostnadsanalyse</h1>
<p>Nytte-kostnadsanalyse er en utredning av offentlige prosjekter som skal hjelpe politikerne og offentlige institusjoner til å prioritere prosjekter.</p>
<p>Det skal være en faglig vurdering og så objektiv som mulig. DFØ har en veileder som skal standardisere prosessen</p>
</section>
<section id="grunner-til-å-gjennomføre-samfunnsøkonomiske-analyser" class="level1">
<h1>Grunner til å gjennomføre samfunnsøkonomiske analyser</h1>
<ul>
<li>Mest mulig velferd ut av samfunnets knappe ressurser ved å sørge for effektiv ressursbruk</li>
<li>En systematisk gjennomgang av alle virkninger for berørte grupper i samfunnet</li>
<li>Sile ut ulønnsomme tiltak på et tidlig tidspunkt</li>
<li>Bidra til et godt, transparent og faglig beslutningsgrunnlag for å
<ul>
<li>rangere og prioritere mellom alternative tiltak</li>
<li>realisere gevinster når tiltaket er iverksatt</li>
<li>ha resultatmål for evaluering av tiltaket i etterkant</li>
<li>gjøre grunnlaget for beslutninger om offentlige tiltak mer synlig for offentligheten</li>
</ul></li>
</ul>
<p>I tillegg finnes det mindre allmennyttige grunner. Mange av de samfunnsøkonomiske analysene som publiseres, gjøres på privat initativ. Målet er da ofte å påvirke politiske beslutninger, i tillegg til at de også kan ha målsetninger som over.</p>
</section>
<section id="hva-lages-det-samfunnsøkonomiske-analyser-om" class="level1">
<h1>Hva lages det samfunnsøkonomiske analyser om?</h1>
<ul>
<li>Alle typer offentlige tiltak: reguleringer, investeringer, tjenesteproduksjon, reformer osv.</li>
<li>På tiltak utført av private aktører på oppdrag for staten</li>
<li>Innenfor alle sektorer i samfunnet</li>
<li>På prioriteringer innenfor en virksomhets ansvarsområder, innad i en sektor eller på tvers av ulike sektorer</li>
</ul>
</section>
<section id="en-samfunnsøkonomisk-analyse-skal" class="level1">
<h1>En samfunnsøkonomisk analyse skal</h1>
<ul>
<li>Ta hensyn til økonomisk kvantifiserbare effekter (prissatte virkninger)</li>
<li>Ta hensyn til ikke-kvantifiserbare effekter (ikke-prissatte virkninger)</li>
<li>I så stor grad som mulig/hensiktsmessig ta med all relevant nytte og alle relevante kostnader</li>
<li>Unngå dobbelttellinger</li>
<li>Ta hensyn til alternativ anvendelse</li>
<li>Ikke ta politiske hensyn</li>
<li>Inneholde en usikkerhetsanalyse</li>
<li>Beskrive fordelingsvirkninger</li>
<li>Gi en samlet vurdering</li>
</ul>
</section>
<section id="eksempel-ny-kvaløyaforbindelse" class="level1">
<h1>Eksempel: Ny kvaløyaforbindelse</h1>
<p>Fra rapporten:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\img/kvaloya.png" class="img-fluid figure-img"></p>
<figcaption>Ny kvaløyaforbindelse</figcaption>
</figure>
</div>
</section>
<section id="prissatte-konsekvenser" class="level1">
<h1>Prissatte konsekvenser:</h1>
<p>Fra rapporten:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\img/kvaloya_tabell.png" class="img-fluid figure-img"></p>
<figcaption>Tabell prissatte konsekvenser</figcaption>
</figure>
</div>
</section>
<section id="ikke-prissatte-konsekvenser" class="level1">
<h1>Ikke prissatte konsekvenser:</h1>
<p><strong>Landskapsbilde</strong> Alternativ C1 kommer best ut. Alternativene som inneholder Kvaløyforbindelsene B2 og B3, samt B7 (Holt) kommer dårligst ut, og resultatet er at disse alternativene har middels til stor negativ konsekvens for landskapsbilde. Øvrige alternativ har middels negativ konsekvens.</p>
<p><strong>Nærmiljø og friluftsliv</strong> Alternativene som inneholder Kvaløyforbindelsene over Håkøya (B6 og B7) kommer dårligst ut. Resultatet er at disse alternativene har stor negativ konsekvens for nærmiljø og friluftsliv, spesielt gjelder dette B7 som i tillegg berører områder på Holt. Parallell bru (B2) har minst negativ konsekvens for dette temaet. Alternativene som inneholder tverrforbindelsen A4 vil i mindre grad berøre den botaniske hagen i Breivika og kommer således best ut av alternativene for ny tverrforbindelse.</p>
<p><strong>Naturmangfold</strong> Alternativene som inneholder Kvaløyforbindelsene B2 og B3 kommer dårligst ut, og resultatet er at disse alternativene har stor til meget stor negativ konsekvens for naturmangfold. Alternativene over Håkøya (B6 og B7) har begge stor negativ konsekvens. C1 har liten negativ konsekvens. Forslag til kommunedelplan for ny tverrforbindelse og ny forbindelse til Kvaløya 12 Statens vegvesen Region nord</p>
<p><strong>Kulturmiljø</strong> Alternativene som inneholder Kvaløyforbindelsene over Håkøya (B6 og B7) kommer dårligst ut, og resultatet er at disse alternativene har middels til stor negativ konsekvens for kulturmiljø. Øvrige alternativ har middels negativ konsekvens. Det knyttes en del usikkerhet til en del områder (Holt, Langnes), og det vil gjennomføres supplerende markundersøkelser og vurderinger i løpet av barmarksesongen 2015.</p>
<p><strong>Naturressurser</strong> Reindrift: Alternativ som inneholder Kvaløyforbindelsen B3 kommer dårligst ut med middels til stor negativ konsekvens. For øvrige alternativ er konsekvensene satt til middels negativ. Vannressurser: Alternativene som inneholder Kvaløyforbindelsene over Håkøya (B6 og B7) kommer dårligst ut med middels negativ konsekvens. For øvrige alternativene er konsekvensene satt til liten negativ. Jord- og skogbruk: Alternativene som inneholder Kvaløyforbindelsene B3, B6 og B7 kommer dårligst ut med stor negativ konsekvens. Alternativ som inneholder Kvaløyforbindelsen B2 er vurdert til å ha middels til stor negativ konsekvens, C1 til middels negativ konsekvens. Georessurser: Alle alternativene er vurdert til å gi fra liten til middels positiv konsekvens. Årsakene til dette er at det er satt som forutsetning at masseoverskudd er å anse som en ressurs.</p>
</section>
<section id="oppsummering-ikke-prissatte-konsekvenser" class="level1">
<h1>Oppsummering ikke-prissatte konsekvenser:</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\img/kvaloya_ikke_prissatte.png" class="img-fluid figure-img"></p>
<figcaption>Tabell ikke prissatte konsekvenser</figcaption>
</figure>
</div>
<p>Er all relevant nytte og alle relevante kostnader tatt med?</p>
</section>
<section id="usikkerhetsanalyse" class="level1">
<h1>Usikkerhetsanalyse</h1>
<p>Kvaløyaforbindelseutredningen inneholder ingen usikkerhetsanalyse I utredningen for Nord-Norgebanen ser den slik ut</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src=".\img/nnb_usikkerhet.png" class="img-fluid figure-img"></p>
<figcaption>Nordnorgebanen</figcaption>
</figure>
</div>
<p>P50, P15 og P85 er kostnadsanslag hvor sannsynligheten for at kostnadene blir lavere enn tallet er henholdsvis 50%, 15% og 85%. Det er en anlig måte å illustrere usikkerhet</p>
</section>
<section id="fordelingsvirkninger." class="level1">
<h1>Fordelingsvirkninger.</h1>
<p>Kun én av rapportene som er pensum i dette kurset, behandler fordelingsvirkninger. Det kan tyde på at det ikke alltid anses som relevant å ha i rapporter, selv om det står i veilederen.</p>
<p>I veilederen står det at «Formålet med denne arbeidsfasen er å beskrive hvordan virkningene av tiltakene fordeler seg mellom ulike grupper i samfunnet». Videre: «Beskrivelsen av fordelingsvirkningene tas med som en tilleggsanalyse og skal ikke inngå i grunnlaget for selve rangeringen og anbefalingen av tiltak»</p>
</section>
<section id="arbeidsfasene" class="level1">
<h1>Arbeidsfasene</h1>
<ul>
<li>Beskriv problemet og formuler mål</li>
<li>Identifiser og beskriv relevante tiltak</li>
<li>Identifiser og beskrive virkningene</li>
<li>Tallfest, vedsett og vurder virkninger</li>
<li>Vurder samfunnsøkonomisk lønnsomhet</li>
<li>Gjennomfør usikkerhetsanalyse</li>
<li>Beskrive fordelingsvirkninger</li>
<li>Gi en samlet vurdering og anbefal tiltak</li>
</ul>
</section>
<section id="fasene" class="level1">
<h1>Fasene</h1>
<section id="problembeskrivelse" class="level2">
<h2 class="anchored" data-anchor-id="problembeskrivelse">Problembeskrivelse</h2>
<p>En har et problem når dagens situasjon eller utvikling oppfattes å være er en annen enn den som er ønsket. I et samfunn finnes det problemer av mange slag uten at det dermed er en samfunnsoppgave å løse alle disse. De problemene som samfunnet kan eller bør løse, kalles samfunnsproblemer.</p>
<ol type="1">
<li>Beskriv det observerte problemet.</li>
<li>Beskriv årsakene til problemet.</li>
<li>Beskriv og tallfest de samfunnsmessige konsekvensene av problemet.</li>
</ol>
</section>
<section id="hva-er-et-tiltak" class="level2">
<h2 class="anchored" data-anchor-id="hva-er-et-tiltak">Hva er et tiltak?</h2>
<ul>
<li>pedagogiske virkemidler, for eksempel veiledning og informasjon</li>
<li>økonomiske virkemidler, for eksempel avgifter eller tilskudd</li>
<li>regulering, for eksempel påbud eller forbud</li>
<li>organisatoriske virkemidler, for eksempel sentralisering eller desentralisering</li>
<li>offentlige tilbud av produkter og tjenester, for eksempel infrastruktur og helsetjenester</li>
<li>offentlige anskaffelser, for eksempel IKT-tjenester og kontorutstyr</li>
</ul>
</section>
<section id="stegvis-prosess-for-komme-frem-til-de-relevante-tiltakene" class="level2">
<h2 class="anchored" data-anchor-id="stegvis-prosess-for-komme-frem-til-de-relevante-tiltakene">Stegvis prosess for komme frem til de relevante tiltakene</h2>
<ul>
<li>Definer mulighetsrommet.</li>
<li>Utforsk mulighetsrommet.</li>
<li>Grovsil tiltakene.</li>
<li>Beskriv tiltakene og vurder utformingen.</li>
</ul>
</section>
</section>
<section id="struktur-på-forelesningene" class="level1">
<h1>Struktur på forelesningene</h1>
<p>Mine forelesninger tar for seg hvordan man i praksis utarbeider en nytte-kostnadsanalyse, mens Tapas’ forelesninger fokuserer på teorien.<br>
For å lære hvordan slike analyser faktisk skrives, skal vi de neste tre forelesningene gå gjennom utvalgte eksempler.</p>
<p>Hver forelesning starter med en kort introduksjon til dagens tema. Deretter får dere tid til å arbeide med virkelige samfunnsøkonomiske analyser i grupper på inntil tre personer.</p>
<p><a href="https://uit-sok-2301-h25.github.io/index.html">Under pensum</a> finner dere en liste med analyser dere kan velge fra. Hver gruppe velger én rapport, og dere arbeider med den i omtrent en halvtime per forelesning. Til slutt har vi en felles oppsummering der vi deler funnene våre knyttet til dagens tema. Dersom vi ikke rekker å fullføre oppsummeringen, fortsetter vi i neste time.</p>
<p>Det er en fordel om dere ser raskt gjennom <em>deres rapport</em> i forkant, med tanke på temaet for den aktuelle forelesningen.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>